################################################################################
# Copyright 2019 Ververica GmbH
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
################################################################################


# This file defines the default environment for Flink's SQL Client.
# Defaults might be overwritten by a session specific environment.


#==============================================================================
# Table Sources
#==============================================================================

# Define table sources here. See the Table API & SQL documentation for details.

catalogs:
   - name: hcat
     type: hive
     property-version: 1
     hive-version: 2.3.6
     hive-conf-dir: /opt/hive-conf

tables:
  - name: PROD_RATES_HISTORY
    type: source-table
    update-mode: append
    schema:
      - name: RS_TIMESTAMP
        data-type: TIMESTAMP(3)
        rowtime:
          timestamps:
            type: from-field
            from: RS_RAW_TIMESTAMP
          watermarks:
            type: "periodic-bounded"
            delay: 5000
      - name: RS_SYMBOL
        data-type: STRING
      - name: RS_RATE
        data-type: DOUBLE
    connector:
      type: kafka
      version: universal
      topic: Rates
      startup-mode: earliest-offset
      properties:
        - key: zookeeper.connect
          value: not-needed
        - key: bootstrap.servers
          value: kafka:9092
        - key: group.id
          value: testGroup
    format:
      type: csv
      field-delimiter: '|'

  - name: PROD_RATES_HISTORY_SINK
    type: sink-table
    update-mode: append
    schema:
      - name: RS_TIMESTAMP
        data-type: TIMESTAMP(3)
      - name: RS_SYMBOL
        data-type: STRING
      - name: RS_RATE
        data-type: DOUBLE
    connector:
      type: kafka
      version: universal
      topic: Rates
      startup-mode: earliest-offset
      properties:
        - key: zookeeper.connect
          value: not-needed
        - key: bootstrap.servers
          value: kafka:9092
        - key: group.id
          value: testGroup
    format:
      type: csv
      field-delimiter: '|'

  - name: PROD_RATES_TEMPORAL
    type: temporal-table
    history-table: PROD_RATES_HISTORY
    primary-key: RS_SYMBOL
    time-attribute: RS_TIMESTAMP

  - name: PROD_LINEITEM
    type: source-table
    update-mode: append
    schema:
      - name: L_ORDERKEY
        data-type: INTEGER
      - name: L_PARTKEY
        data-type: INTEGER
      - name: L_SUPPKEY
        data-type: INTEGER
      - name: L_LINENUMBER
        data-type: INTEGER
      - name: L_QUANTITY
        data-type: DOUBLE
      - name: L_EXTENDEDPRICE
        data-type: DOUBLE
      - name: L_DISCOUNT
        data-type: DOUBLE
      - name: L_TAX
        data-type: DOUBLE
      - name: L_CURRENCY
        data-type: STRING
      - name: L_RETURNFLAG
        data-type: STRING
      - name: L_LINESTATUS
        data-type: STRING
      - name: L_ORDERTIME
        data-type: TIMESTAMP(3)
        rowtime:
          timestamps:
            type: from-field
            from: L_RAW_ORDERTIME
          watermarks:
            type: "periodic-bounded"
            delay: 5000
      - name: L_SHIPINSTRUCT
        data-type: STRING
      - name: L_SHIPMODE
        data-type: STRING
      - name: L_COMMENT
        data-type: STRING
      - name: L_PROCTIME
        data-type: TIMESTAMP(3)
        proctime: true
    connector:
      type: kafka
      version: universal
      topic: Lineitem
      startup-mode: 'earliest-offset'
      properties:
        - key: zookeeper.connect
          value: not-needed
        - key: bootstrap.servers
          value: kafka:9092
        - key: group.id
          value: testGroup
    format:
      type: csv
      field-delimiter: '|'

  - name: PROD_LINEITEM_SINK
    type: sink-table
    update-mode: append
    schema:
      - name: L_ORDERKEY
        data-type: INTEGER
      - name: L_PARTKEY
        data-type: INTEGER
      - name: L_SUPPKEY
        data-type: INTEGER
      - name: L_LINENUMBER
        data-type: INTEGER
      - name: L_QUANTITY
        data-type: DOUBLE
      - name: L_EXTENDEDPRICE
        data-type: DOUBLE
      - name: L_DISCOUNT
        data-type: DOUBLE
      - name: L_TAX
        data-type: DOUBLE
      - name: L_CURRENCY
        data-type: STRING
      - name: L_RETURNFLAG
        data-type: STRING
      - name: L_LINESTATUS
        data-type: STRING
      - name: L_ORDERTIME
        data-type: TIMESTAMP(3)
      - name: L_SHIPINSTRUCT
        data-type: STRING
      - name: L_SHIPMODE
        data-type: STRING
      - name: L_COMMENT
        data-type: STRING
    connector:
      type: kafka
      version: universal
      topic: Lineitem
      startup-mode: 'earliest-offset'
      properties:
        - key: zookeeper.connect
          value: not-needed
        - key: bootstrap.servers
          value: kafka:9092
        - key: group.id
          value: testGroup
    format:
      type: csv
      field-delimiter: '|'

  - name: PROD_ORDERS
    type: source-table
    update-mode: append
    schema:
      - name: O_ORDERKEY
        data-type: INTEGER
      - name: O_CUSTKEY
        data-type: INTEGER
      - name: O_ORDERSTATUS
        data-type: STRING
      - name: O_TOTALPRICE
        data-type: DOUBLE
      - name: O_CURRENCY
        data-type: STRING
      - name: O_ORDERTIME
        data-type: TIMESTAMP(3)
        rowtime:
          timestamps:
            type: from-field
            from: O_RAW_ORDERTIME
          watermarks:
            type: "periodic-bounded"
            delay: 5000
      - name: O_ORDERPRIORITY
        data-type: STRING
      - name: O_CLERK
        data-type: STRING
      - name: O_SHIPPRIORITY
        data-type: INTEGER
      - name: O_COMMENT
        data-type: STRING
    connector:
      type: kafka
      version: universal
      topic: Orders
      startup-mode: 'earliest-offset'
      properties:
        - key: zookeeper.connect
          value: not-needed
        - key: bootstrap.servers
          value: kafka:9092
        - key: group.id
          value: testGroup
    format:
      type: csv
      field-delimiter: '|'

  - name: PROD_ORDERS_SINK
    type: sink-table
    update-mode: append
    schema:
      - name: O_ORDERKEY
        data-type: INTEGER
      - name: O_CUSTKEY
        data-type: INTEGER
      - name: O_ORDERSTATUS
        data-type: STRING
      - name: O_TOTALPRICE
        data-type: DOUBLE
      - name: O_CURRENCY
        data-type: STRING
      - name: O_ORDERTIME
        data-type: TIMESTAMP(3)
      - name: O_ORDERPRIORITY
        data-type: STRING
      - name: O_CLERK
        data-type: STRING
      - name: O_SHIPPRIORITY
        data-type: INTEGER
      - name: O_COMMENT
        data-type: STRING
    connector:
      type: kafka
      version: universal
      topic: Orders
      startup-mode: 'earliest-offset'
      properties:
        - key: zookeeper.connect
          value: not-needed
        - key: bootstrap.servers
          value: kafka:9092
        - key: group.id
          value: testGroup
    format:
      type: csv
      field-delimiter: '|'

#==============================================================================
# Execution properties
#==============================================================================

# Execution properties allow for changing the behavior of a table program.

execution:
  planner: blink               # using the Blink planner
  type: streaming              # 'batch' or 'streaming' execution
  result-mode: table           # 'changelog' or 'table' presentation of results
  parallelism: 1               # parallelism of the program
  max-parallelism: 128         # maximum parallelism
  min-idle-state-retention: 0  # minimum idle state retention in ms
  max-idle-state-retention: 0  # maximum idle state retention in ms

#==============================================================================
# Deployment properties
#==============================================================================

# Deployment properties allow for describing the cluster to which table
# programs are submitted to.

deployment:
  type: standalone             # only the 'standalone' deployment is supported
  response-timeout: 5000       # general cluster communication timeout in ms
  gateway-address: ""          # (optional) address from cluster to gateway
  gateway-port: 0              # (optional) port from cluster to gateway


